<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JHCSC Link | Campus Connections</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: {
                        brand: {
                            50: '#ecfdf5', 100: '#d1fae5', 200: '#a7f3d0', 300: '#6ee7b7',
                            400: '#34d399', 500: '#10b981', 600: '#059669', 700: '#047857',
                            800: '#065f46', 900: '#064e3b', 950: '#022c22',
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.5s ease-out',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #f0fdf4;
        }
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Chat bubbles */
        .chat-bubble { position: relative; max-width: 80%; padding: 10px 16px; border-radius: 20px; font-size: 0.95rem; line-height: 1.4; }
        .chat-mine { background: #10b981; color: white; margin-left: auto; border-bottom-right-radius: 4px; }
        .chat-theirs { background: #e5e7eb; color: #1f2937; margin-right: auto; border-bottom-left-radius: 4px; }
    </style>
</head>
<body class="text-gray-800 antialiased h-screen w-screen overflow-hidden relative selection:bg-brand-200 selection:text-brand-900">

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-[60] transition-all duration-300 translate-y-[-150%] opacity-0">
        <div class="glass px-6 py-3 rounded-full shadow-xl flex items-center gap-3 border border-brand-200">
            <div id="toast-icon" class="bg-brand-100 p-1.5 rounded-full text-brand-600"></div>
            <span id="toast-msg" class="font-medium text-sm text-brand-900">Notification</span>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app" class="h-full w-full"></div>

    <script>
        // --- MOCK DATA ---
        const CAMPUSES = ['Main Campus', 'Dumingag', 'Pagadian Annex', 'Canuto MS Enerio'];
        
        const STORIES = [
            { id: 1, name: "Sarah", img: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=150&h=150&fit=crop", active: true },
            { id: 2, name: "Mark", img: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=150&h=150&fit=crop", active: true },
            { id: 3, name: "Jenny", img: "https://images.unsplash.com/photo-1517841905240-472988babdf9?w=150&h=150&fit=crop", active: false },
            { id: 4, name: "Kevin", img: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=150&h=150&fit=crop", active: false },
            { id: 5, name: "Miguel", img: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop", active: true },
            { id: 6, name: "Sofia", img: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=150&h=150&fit=crop", active: true },
        ];

        const EVENTS = [
            { id: 1, title: "Grand Library Study Night", date: "Oct 24 ‚Ä¢ 6:00 PM", loc: "Main Library", icon: "book-open", color: "bg-blue-100 text-blue-600" },
            { id: 2, title: "Campus Intramurals Opening", date: "Nov 05 ‚Ä¢ 8:00 AM", loc: "Gymnasium", icon: "trophy", color: "bg-orange-100 text-orange-600" },
            { id: 3, title: "Music & Arts Festival", date: "Nov 12 ‚Ä¢ 4:00 PM", loc: "Open Field", icon: "music", color: "bg-purple-100 text-purple-600" }
        ];

        const USERS = [
            { 
                id: 1, name: "Sarah Magbanua", age: 20, gender: "Female", course: "BS Agriculture", year: "3rd Year", campus: "Main Campus",
                bio: "Sustainable farming advocate. Looking for a study buddy for Soil Science! üå±",
                image: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=600&q=80",
                interests: ["Nature", "Volleyball", "Coffee"], online: true
            },
            { 
                id: 2, name: "Mark Reyes", age: 21, gender: "Male", course: "BS Info Tech", year: "4th Year", campus: "Dumingag",
                bio: "Full stack developer. Let's debug life together. üíª",
                image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=600&q=80",
                interests: ["Coding", "Valorant", "Anime"], online: false
            },
            { 
                id: 3, name: "Jenny Alcantara", age: 19, gender: "Female", course: "B Secondary Ed", year: "2nd Year", campus: "Main Campus",
                bio: "Future educator. I love poetry and watching sunsets at the oval. üåÖ",
                image: "https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=600&q=80",
                interests: ["Teaching", "Poetry", "Travel"], online: true
            },
            { 
                id: 4, name: "Kevin Tan", age: 22, gender: "Male", course: "BS Criminology", year: "4th Year", campus: "Pagadian Annex",
                bio: "Discipline is key. Looking for a serious connection. üëÆ‚Äç‚ôÇÔ∏è",
                image: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=600&q=80",
                interests: ["Gym", "Hiking", "Cooking"], online: false
            },
            { 
                id: 5, name: "Bea Alonzo", age: 20, gender: "Female", course: "BS Nursing", year: "2nd Year", campus: "Main Campus",
                bio: "Caring and sweet. Just want someone to unwind with after clinicals. üíâ",
                image: "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=600&q=80",
                interests: ["Health", "Movies", "Dogs"], online: true
            },
            { 
                id: 6, name: "Miguel Santos", age: 21, gender: "Male", course: "BS Civil Engineering", year: "3rd Year", campus: "Main Campus",
                bio: "Math wiz looking for gym buddies. üí™",
                image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=600&q=80",
                interests: ["Calculus", "Gym", "Chess"], online: false
            },
            { 
                id: 7, name: "Sofia Garcia", age: 19, gender: "Female", course: "BA English", year: "1st Year", campus: "Canuto MS Enerio",
                bio: "Bookworm and coffee addict. Let's explore local cafes!",
                image: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?auto=format&fit=crop&w=600&q=80",
                interests: ["Books", "Coffee", "Writing"], online: true
            },
            { 
                id: 8, name: "Rico J. Puno", age: 23, gender: "Male", course: "BS Agriculture", year: "4th Year", campus: "Dumingag",
                bio: "Music lover and guitarist. Jam sessions? üé∏",
                image: "https://images.unsplash.com/photo-1480455624313-e29b44bbfde1?auto=format&fit=crop&w=600&q=80",
                interests: ["Music", "Guitar", "Farming"], online: true
            }
        ];

        // --- STATE MANAGEMENT ---
        const StorageKey = 'JHCSC_LINK_V2';
        
        let state = {
            view: 'landing', // landing, auth, dashboard, messages, chat, events, profile
            user: null,
            users: [...USERS],
            matches: [], // Array of user IDs
            chats: {}, // { userId: [{ text, sender: 'me'|'them', time }] }
            activeChatId: null,
            filter: 'All'
        };

        // Load from LocalStorage
        const saved = localStorage.getItem(StorageKey);
        if (saved) {
            const parsed = JSON.parse(saved);
            state = { ...state, ...parsed };
            // Reset view to dashboard if logged in, else landing
            state.view = state.user ? 'dashboard' : 'landing';
        }

        function saveState() {
            localStorage.setItem(StorageKey, JSON.stringify({
                user: state.user,
                matches: state.matches,
                chats: state.chats
            }));
        }

        // --- CORE FUNCTIONS ---

        function setView(view, param = null) {
            state.view = view;
            if (view === 'chat' && param) state.activeChatId = param;
            render();
        }

        function showToast(msg, iconType = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toast-icon');
            const txt = document.getElementById('toast-msg');
            
            icon.innerHTML = iconType === 'success' ? '<i data-lucide="check" class="w-4 h-4"></i>' : '<i data-lucide="alert-circle" class="w-4 h-4"></i>';
            icon.className = iconType === 'success' ? 'bg-brand-100 p-1.5 rounded-full text-brand-600' : 'bg-red-100 p-1.5 rounded-full text-red-600';
            txt.innerText = msg;
            
            toast.classList.remove('translate-y-[-150%]', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-[-150%]', 'opacity-0'), 3000);
            lucide.createIcons();
        }

        // --- ACTIONS ---

        function handleAuth(e, type) {
            e.preventDefault();
            const form = e.target;
            
            // Simulation
            const mockUser = {
                id: 999,
                name: type === 'register' ? form.name.value : "Current Student",
                email: form.email.value,
                image: `https://ui-avatars.com/api/?name=${type === 'register' ? form.name.value : 'Student'}&background=10b981&color=fff`,
                course: "BS Info Tech", year: "3rd Year", campus: "Main Campus",
                bio: "Just joined! excited to meet everyone.",
                interests: ["Newbie", "Tech"]
            };

            state.user = mockUser;
            saveState();
            showToast(`Welcome, ${state.user.name.split(' ')[0]}!`);
            setView('dashboard');
        }

        function toggleMatch(id) {
            const index = state.matches.indexOf(id);
            if (index === -1) {
                state.matches.push(id);
                showToast("Connected! You can now chat.", "success");
                
                // Simulate incoming message
                if (!state.chats[id]) {
                    state.chats[id] = [];
                    setTimeout(() => {
                        receiveMessage(id, "Hey! Thanks for connecting. üëã");
                        showToast("New message received!", "success");
                        render(); // Re-render to show badge
                    }, 2500);
                }
            } else {
                state.matches.splice(index, 1);
                showToast("Connection removed", "error");
            }
            saveState();
            render();
        }

        function sendMessage(e) {
            e.preventDefault();
            const input = e.target.querySelector('input');
            const text = input.value;
            if(!text.trim()) return;

            const chatId = state.activeChatId;
            if (!state.chats[chatId]) state.chats[chatId] = [];

            // Add my message
            state.chats[chatId].push({ text, sender: 'me', time: 'Just now' });
            input.value = '';
            saveState();
            render(); // Update UI immediately

            // Auto reply simulation
            setTimeout(() => {
                const replies = ["That's cool!", "I agree completely.", "Haha nice one.", "Are you free to study later?", "Which campus are you at?"];
                const randomReply = replies[Math.floor(Math.random() * replies.length)];
                receiveMessage(chatId, randomReply);
            }, 2000);
        }

        function receiveMessage(userId, text) {
            if (!state.chats[userId]) state.chats[userId] = [];
            state.chats[userId].push({ text, sender: 'them', time: 'Just now' });
            saveState();
            render();
        }

        function logout() {
            state.user = null;
            state.matches = [];
            state.chats = {};
            localStorage.removeItem(StorageKey);
            setView('landing');
        }

        // --- RENDERERS ---

        function render() {
            const app = document.getElementById('app');
            app.innerHTML = '';

            if (state.view === 'landing') renderLanding(app);
            else if (state.view === 'login' || state.view === 'register') renderAuthForm(app);
            else {
                // Authenticated Layout
                renderAppLayout(app);
            }
            lucide.createIcons();
        }

        function renderLanding(container) {
            container.innerHTML = `
                <div class="relative h-full w-full flex flex-col items-center justify-center overflow-hidden bg-brand-50">
                    <!-- Decor Blobs -->
                    <div class="absolute top-[-10%] right-[-5%] w-96 h-96 bg-brand-300 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-float"></div>
                    <div class="absolute bottom-[-10%] left-[-10%] w-96 h-96 bg-emerald-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-float" style="animation-delay: 2s"></div>

                    <div class="z-10 text-center px-6 max-w-2xl">
                        <div class="inline-flex items-center gap-2 bg-white/80 backdrop-blur-sm px-4 py-2 rounded-full shadow-sm mb-6 animate-slide-up">
                            <i data-lucide="sparkles" class="w-4 h-4 text-brand-500"></i>
                            <span class="text-sm font-semibold text-brand-800">#1 Platform for JHCSC Students</span>
                        </div>
                        
                        <h1 class="text-5xl md:text-7xl font-extrabold text-brand-950 tracking-tight mb-6 animate-slide-up" style="animation-delay: 0.1s">
                            JHCSC <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-600 to-emerald-400">Link</span>
                        </h1>
                        
                        <p class="text-lg md:text-xl text-gray-600 mb-10 leading-relaxed animate-slide-up" style="animation-delay: 0.2s">
                            Connect with fellow students, find study buddies, or discover your campus soulmate. Safe, exclusive, and fun.
                        </p>

                        <div class="flex flex-col sm:flex-row gap-4 justify-center animate-slide-up" style="animation-delay: 0.3s">
                            <button onclick="setView('register')" class="bg-brand-600 text-white px-8 py-4 rounded-xl font-bold shadow-lg hover:bg-brand-700 hover:shadow-brand-500/30 transition transform hover:-translate-y-1 flex items-center justify-center gap-2">
                                Get Started <i data-lucide="arrow-right" class="w-5 h-5"></i>
                            </button>
                            <button onclick="setView('login')" class="bg-white text-brand-800 px-8 py-4 rounded-xl font-bold shadow-md hover:bg-gray-50 transition border border-brand-100">
                                I have an account
                            </button>
                        </div>
                    </div>

                    <!-- Floating Card Mockup -->
                    <div class="mt-16 relative z-10 animate-slide-up hidden md:block" style="animation-delay: 0.4s">
                        <div class="glass p-4 rounded-3xl shadow-2xl transform rotate-[-2deg] hover:rotate-0 transition duration-500 max-w-sm">
                            <div class="flex items-center gap-4">
                                <img src="${USERS[0].image}" class="w-16 h-16 rounded-2xl object-cover shadow-sm">
                                <div>
                                    <h3 class="font-bold text-lg text-gray-900">Sarah Magbanua</h3>
                                    <p class="text-brand-600 text-sm">BS Agriculture ‚Ä¢ 3rd Year</p>
                                </div>
                                <div class="ml-auto bg-brand-100 p-2 rounded-full text-brand-600">
                                    <i data-lucide="heart" class="w-5 h-5 fill-current"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAuthForm(container) {
            const isReg = state.view === 'register';
            container.innerHTML = `
                <div class="h-full w-full flex overflow-hidden bg-white">
                    <!-- Left Side: Visuals (Desktop only) -->
                    <div class="hidden md:flex w-1/2 lg:w-3/5 bg-brand-900 relative items-center justify-center overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1523050854058-8df90110c9f1?q=80&w=1500&auto=format&fit=crop')] bg-cover bg-center opacity-40 mix-blend-overlay"></div>
                        <div class="absolute inset-0 bg-gradient-to-t from-brand-900 via-transparent to-transparent"></div>
                        
                        <div class="relative z-10 p-12 text-white max-w-lg animate-fade-in">
                            <div class="mb-6 bg-white/10 backdrop-blur-md inline-flex items-center gap-2 px-4 py-2 rounded-full border border-white/20">
                                <i data-lucide="users" class="w-4 h-4"></i>
                                <span class="text-sm font-medium">Join 3,500+ Students</span>
                            </div>
                            <h2 class="text-5xl font-extrabold tracking-tight leading-tight mb-6">
                                ${isReg ? "Your Campus Life Starts Here." : "Welcome Back to Your Community."}
                            </h2>
                            <p class="text-brand-100 text-lg leading-relaxed mb-8">
                                Connect with peers from Main Campus to Dumingag. Find study groups, events, and meaningful connections in a safe, verified environment.
                            </p>
                            
                            <!-- Testimonial Mini -->
                            <div class="flex items-center gap-4 bg-brand-800/50 p-4 rounded-2xl backdrop-blur-sm border border-brand-700">
                                <img src="${USERS[0].image}" class="w-10 h-10 rounded-full object-cover border-2 border-brand-500">
                                <div>
                                    <p class="text-sm font-medium italic">"Found my best friend and study buddy here!"</p>
                                    <p class="text-xs text-brand-300 mt-1">Sarah M. ‚Ä¢ BS Agriculture</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Side: Form -->
                    <div class="w-full md:w-1/2 lg:w-2/5 flex flex-col justify-center p-8 md:p-12 lg:p-16 relative">
                         <!-- Removed Back to Home button -->

                        <div class="max-w-sm mx-auto w-full animate-slide-up">
                            <div class="mb-8">
                                <div class="w-12 h-12 bg-brand-100 rounded-xl flex items-center justify-center text-brand-600 mb-4 transform rotate-[-5deg]">
                                    <i data-lucide="${isReg ? 'sparkles' : 'lock'}" class="w-6 h-6"></i>
                                </div>
                                <h2 class="text-3xl font-bold text-gray-900 tracking-tight">${isReg ? 'Create Account' : 'Sign In'}</h2>
                                <p class="text-gray-500 mt-2 text-sm">
                                    ${isReg ? 'Enter your details to join the JHCSC network.' : 'Welcome back! Please enter your details.'}
                                </p>
                            </div>

                            <form onsubmit="handleAuth(event, '${state.view}')" class="space-y-4">
                                ${isReg ? `
                                <div class="space-y-1.5">
                                    <label class="text-xs font-semibold text-gray-700 uppercase tracking-wide">Full Name</label>
                                    <div class="relative group">
                                        <i data-lucide="user" class="absolute left-3 top-3.5 w-5 h-5 text-gray-400 group-focus-within:text-brand-500 transition"></i>
                                        <input type="text" name="name" class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:bg-white focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition font-medium" placeholder="Juan Dela Cruz" required>
                                    </div>
                                </div>` : ''}
                                
                                <div class="space-y-1.5">
                                    <label class="text-xs font-semibold text-gray-700 uppercase tracking-wide">Student Email</label>
                                     <div class="relative group">
                                        <i data-lucide="mail" class="absolute left-3 top-3.5 w-5 h-5 text-gray-400 group-focus-within:text-brand-500 transition"></i>
                                        <input type="email" name="email" class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:bg-white focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition font-medium" placeholder="id@jhcsc.edu.ph" required>
                                    </div>
                                </div>
                                
                                <div class="space-y-1.5">
                                    <div class="flex justify-between">
                                        <label class="text-xs font-semibold text-gray-700 uppercase tracking-wide">Password</label>
                                        ${!isReg ? '<a href="#" class="text-xs font-medium text-brand-600 hover:text-brand-700">Forgot?</a>' : ''}
                                    </div>
                                     <div class="relative group">
                                        <i data-lucide="lock" class="absolute left-3 top-3.5 w-5 h-5 text-gray-400 group-focus-within:text-brand-500 transition"></i>
                                        <input type="password" name="password" class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 bg-gray-50 focus:bg-white focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none transition font-medium" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                                    </div>
                                </div>

                                <button type="submit" class="w-full bg-brand-600 text-white font-bold py-3.5 rounded-xl hover:bg-brand-700 hover:translate-y-[-1px] transition shadow-lg shadow-brand-600/20 mt-2 flex items-center justify-center gap-2">
                                    ${isReg ? 'Get Started' : 'Sign In'} <i data-lucide="arrow-right" class="w-4 h-4"></i>
                                </button>
                            </form>

                            <div class="mt-8 pt-6 border-t border-gray-100 text-center">
                                <p class="text-sm text-gray-600">
                                    ${isReg ? 'Already a member?' : "Don't have an account?"}
                                    <button onclick="setView('${isReg ? 'login' : 'register'}')" class="font-bold text-brand-700 hover:text-brand-800 transition ml-1 hover:underline">
                                        ${isReg ? 'Sign in' : "Create account"}
                                    </button>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAppLayout(container) {
            let contentHTML = '';
            const topBar = `
                <div class="sticky top-0 z-40 glass border-b border-gray-200 px-4 py-3 flex justify-between items-center">
                    <div class="flex items-center gap-2 font-bold text-xl text-brand-900">
                        <i data-lucide="flower-2" class="text-brand-600 fill-brand-100"></i>
                        <span>Link</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="showToast('No new notifications')" class="p-2 text-gray-500 hover:bg-gray-100 rounded-full relative">
                            <i data-lucide="bell" class="w-5 h-5"></i>
                            <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full"></span>
                        </button>
                        <img src="${state.user.image}" class="w-9 h-9 rounded-full border border-brand-200 cursor-pointer" onclick="setView('profile')">
                    </div>
                </div>
            `;

            if (state.view === 'dashboard') contentHTML = getDashboardHTML();
            else if (state.view === 'messages') contentHTML = getMessagesListHTML();
            else if (state.view === 'chat') contentHTML = getChatHTML();
            else if (state.view === 'events') contentHTML = getEventsHTML();
            else if (state.view === 'profile') contentHTML = getProfileHTML();

            const bottomNav = `
                <div class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 pb-safe z-50 md:sticky md:top-20 md:w-20 md:h-screen md:border-r md:border-t-0 md:flex md:flex-col md:items-center md:py-8">
                    <div class="flex justify-around items-center px-2 py-3 md:flex-col md:gap-8 md:w-full">
                        ${navItem('dashboard', 'home', 'Home')}
                        ${navItem('events', 'calendar', 'Events')}
                        ${navItem('messages', 'message-circle', 'Chat', true)}
                        ${navItem('profile', 'user', 'Profile')}
                    </div>
                </div>
            `;

            container.innerHTML = `
                <div class="h-full w-full bg-gray-50 flex flex-col md:flex-row overflow-hidden">
                    <div class="hidden md:block w-64 flex-shrink-0 z-50">
                        <!-- Desktop Sidebar Placeholder -->
                        <div class="fixed h-full w-64 bg-white border-r border-gray-200 p-6">
                            <h1 class="text-2xl font-extrabold text-brand-800 mb-8 flex items-center gap-2">
                                <i data-lucide="flower-2"></i> JHCSC Link
                            </h1>
                            <nav class="space-y-2">
                                ${desktopNavItem('dashboard', 'home', 'Discover')}
                                ${desktopNavItem('events', 'calendar', 'Campus Events')}
                                ${desktopNavItem('messages', 'message-circle', 'Messages')}
                                ${desktopNavItem('profile', 'user', 'My Profile')}
                                <button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-red-50 hover:text-red-600 rounded-xl transition mt-8 font-medium">
                                    <i data-lucide="log-out" class="w-5 h-5"></i> Logout
                                </button>
                            </nav>
                        </div>
                    </div>
                    
                    <div class="flex-1 flex flex-col h-full relative">
                        <!-- Mobile Top Bar only -->
                        <div class="md:hidden flex-shrink-0">
                            ${topBar}
                        </div>
                        
                        <main class="flex-1 overflow-y-auto pb-20 md:pb-0">
                            ${contentHTML}
                        </main>

                        <!-- Mobile Bottom Nav only -->
                        <div class="md:hidden">
                            ${bottomNav}
                        </div>
                    </div>
                </div>
            `;
        }

        // --- HTML GENERATORS ---

        function navItem(view, icon, label, hasBadge = false) {
            const active = state.view === view;
            // Check for unread messages only if hasBadge is true (simple logic: matches count > 0)
            const showBadge = hasBadge && state.matches.length > 0;
            return `
                <button onclick="setView('${view}')" class="flex flex-col items-center gap-1 w-16 transition ${active ? 'text-brand-600 scale-105' : 'text-gray-400 hover:text-gray-600'}">
                    <div class="relative">
                        <i data-lucide="${icon}" class="${active ? 'fill-current' : ''} w-6 h-6"></i>
                        ${showBadge ? '<span class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white"></span>' : ''}
                    </div>
                    <span class="text-[10px] font-medium">${label}</span>
                </button>
            `;
        }

        function desktopNavItem(view, icon, label) {
            const active = state.view === view;
            return `
                <button onclick="setView('${view}')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition font-medium ${active ? 'bg-brand-50 text-brand-700' : 'text-gray-600 hover:bg-gray-50'}">
                    <i data-lucide="${icon}" class="w-5 h-5 ${active ? 'fill-brand-200' : ''}"></i>
                    ${label}
                </button>
            `;
        }

        function getDashboardHTML() {
            const filteredUsers = state.users.filter(u => u.id !== state.user.id);
            const storiesHTML = STORIES.map(s => `
                <div class="flex flex-col items-center gap-2 cursor-pointer group">
                    <div class="p-[3px] rounded-full ${s.active ? 'bg-gradient-to-tr from-brand-400 to-blue-500' : 'bg-gray-200'}">
                        <img src="${s.img}" class="w-16 h-16 rounded-full border-2 border-white group-hover:scale-95 transition">
                    </div>
                    <span class="text-xs font-medium text-gray-600">${s.name}</span>
                </div>
            `).join('');

            const cardsHTML = filteredUsers.map(u => {
                const isMatch = state.matches.includes(u.id);
                return `
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden group hover:shadow-xl hover:border-brand-200 transition-all duration-300">
                        <div class="relative h-72">
                            <img src="${u.image}" class="w-full h-full object-cover group-hover:scale-105 transition duration-700">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
                            <div class="absolute top-3 right-3 bg-white/20 backdrop-blur-md px-2 py-1 rounded-lg text-white text-xs font-medium border border-white/20">
                                ${u.distance || '1.2 km away'}
                            </div>
                            <div class="absolute bottom-0 left-0 p-5 text-white w-full">
                                <h3 class="text-2xl font-bold flex items-center gap-2">
                                    ${u.name}, ${u.age} 
                                    ${u.online ? '<span class="w-2.5 h-2.5 bg-green-400 rounded-full shadow-[0_0_10px_rgba(74,222,128,0.5)]"></span>' : ''}
                                </h3>
                                <p class="text-gray-300 text-sm flex items-center gap-1 mt-1">
                                    <i data-lucide="map-pin" class="w-3 h-3"></i> ${u.campus}
                                </p>
                            </div>
                        </div>
                        <div class="p-5">
                            <div class="flex gap-2 mb-3">
                                <span class="text-xs font-semibold bg-brand-50 text-brand-700 px-2.5 py-1 rounded-md">${u.course}</span>
                                <span class="text-xs font-semibold bg-blue-50 text-blue-700 px-2.5 py-1 rounded-md">${u.year}</span>
                            </div>
                            <p class="text-gray-600 text-sm mb-4 line-clamp-2 leading-relaxed">"${u.bio}"</p>
                            
                            <button onclick="toggleMatch(${u.id})" class="w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition ${isMatch ? 'bg-brand-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-brand-50 hover:text-brand-600'}">
                                <i data-lucide="${isMatch ? 'message-circle' : 'heart'}" class="w-5 h-5 ${isMatch ? '' : 'fill-current opacity-0 group-hover:opacity-100 transition'}"></i>
                                ${isMatch ? 'Chat Now' : 'Connect'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <div class="max-w-6xl mx-auto p-4 md:p-8 space-y-8 animate-slide-up">
                    <!-- Stories -->
                    <div class="flex gap-4 overflow-x-auto pb-4 no-scrollbar">
                        <div class="flex flex-col items-center gap-2 cursor-pointer flex-shrink-0">
                            <div class="w-16 h-16 rounded-full bg-gray-100 border-2 border-gray-300 border-dashed flex items-center justify-center text-gray-400 hover:text-brand-600 hover:border-brand-400 transition">
                                <i data-lucide="plus" class="w-6 h-6"></i>
                            </div>
                            <span class="text-xs font-medium text-gray-500">Add Story</span>
                        </div>
                        ${storiesHTML}
                    </div>

                    <!-- Filters -->
                    <div class="flex gap-2 overflow-x-auto no-scrollbar pb-2">
                        <button class="px-5 py-2 rounded-full bg-brand-600 text-white text-sm font-medium shadow-md shadow-brand-200">All</button>
                        <button class="px-5 py-2 rounded-full bg-white text-gray-600 border border-gray-200 text-sm font-medium whitespace-nowrap">Main Campus</button>
                        <button class="px-5 py-2 rounded-full bg-white text-gray-600 border border-gray-200 text-sm font-medium whitespace-nowrap">Dumingag</button>
                        <button class="px-5 py-2 rounded-full bg-white text-gray-600 border border-gray-200 text-sm font-medium whitespace-nowrap">Online Now</button>
                    </div>

                    <!-- Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${cardsHTML}
                    </div>
                </div>
            `;
        }

        function getMessagesListHTML() {
            if (state.matches.length === 0) {
                return `
                    <div class="h-[70vh] flex flex-col items-center justify-center text-center p-6 animate-slide-up">
                        <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-gray-400">
                            <i data-lucide="ghost" class="w-10 h-10"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">No messages yet</h3>
                        <p class="text-gray-500 mt-2 max-w-xs">Start connecting with people on the Discover page to start chatting!</p>
                        <button onclick="setView('dashboard')" class="mt-6 text-brand-600 font-bold hover:underline">Find People</button>
                    </div>
                `;
            }

            const list = state.matches.map(id => {
                const u = state.users.find(user => user.id === id);
                const chatHistory = state.chats[id] || [];
                const lastMsg = chatHistory.length > 0 ? chatHistory[chatHistory.length - 1].text : "Start the conversation!";
                const lastTime = chatHistory.length > 0 ? chatHistory[chatHistory.length - 1].time : "";

                return `
                    <div onclick="setView('chat', ${id})" class="flex items-center gap-4 p-4 bg-white hover:bg-gray-50 border-b border-gray-100 cursor-pointer transition">
                        <div class="relative">
                            <img src="${u.image}" class="w-14 h-14 rounded-full object-cover">
                            <div class="absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-baseline mb-1">
                                <h4 class="font-bold text-gray-900 truncate">${u.name}</h4>
                                <span class="text-xs text-gray-400 font-medium">${lastTime}</span>
                            </div>
                            <p class="text-sm text-gray-500 truncate ${chatHistory.length === 0 ? 'italic text-brand-600' : ''}">${lastMsg}</p>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <div class="bg-white min-h-full animate-slide-up">
                    <div class="p-4 border-b border-gray-100">
                        <h2 class="text-xl font-bold text-gray-900">Messages</h2>
                    </div>
                    ${list}
                </div>
            `;
        }

        function getChatHTML() {
            const u = state.users.find(user => user.id === state.activeChatId);
            const messages = state.chats[state.activeChatId] || [];

            const msgsHTML = messages.map(m => `
                <div class="w-full flex mb-3 ${m.sender === 'me' ? 'justify-end' : 'justify-start'}">
                    <div class="chat-bubble ${m.sender === 'me' ? 'chat-mine shadow-md shadow-brand-200' : 'chat-theirs'}">
                        ${m.text}
                    </div>
                </div>
            `).join('');

            return `
                <div class="flex flex-col h-full bg-white">
                    <!-- Header -->
                    <div class="flex items-center gap-3 p-3 border-b border-gray-100 shadow-sm z-10 sticky top-0 bg-white/90 backdrop-blur">
                        <button onclick="setView('messages')" class="p-2 hover:bg-gray-100 rounded-full">
                            <i data-lucide="arrow-left" class="w-6 h-6 text-gray-600"></i>
                        </button>
                        <img src="${u.image}" class="w-10 h-10 rounded-full object-cover">
                        <div>
                            <h3 class="font-bold text-sm text-gray-900">${u.name}</h3>
                            <p class="text-xs text-green-600 font-medium">Online</p>
                        </div>
                    </div>

                    <!-- Body -->
                    <div class="flex-1 overflow-y-auto p-4 bg-gray-50" id="chat-container">
                        <div class="text-center text-xs text-gray-400 my-4">Today</div>
                        ${msgsHTML.length ? msgsHTML : '<div class="text-center text-gray-400 mt-10">Say hello! üëã</div>'}
                    </div>

                    <!-- Input -->
                    <div class="p-3 bg-white border-t border-gray-100">
                        <form onsubmit="sendMessage(event)" class="flex gap-2">
                            <button type="button" class="p-3 text-gray-400 hover:bg-gray-100 rounded-full transition">
                                <i data-lucide="plus" class="w-6 h-6"></i>
                            </button>
                            <input type="text" placeholder="Type a message..." class="flex-1 bg-gray-100 text-gray-900 px-4 rounded-full outline-none focus:ring-2 focus:ring-brand-200 transition" autofocus>
                            <button type="submit" class="p-3 bg-brand-600 text-white rounded-full hover:bg-brand-700 transition shadow-md shadow-brand-200">
                                <i data-lucide="send" class="w-5 h-5 ml-0.5"></i>
                            </button>
                        </form>
                    </div>
                </div>
            `;
        }

        function getEventsHTML() {
            const list = EVENTS.map(evt => `
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-gray-100 flex items-start gap-4 hover:shadow-md transition cursor-pointer">
                    <div class="${evt.color} w-14 h-14 rounded-2xl flex items-center justify-center flex-shrink-0">
                        <i data-lucide="${evt.icon}" class="w-7 h-7"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-900 text-lg">${evt.title}</h3>
                            <span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-md font-medium">Free</span>
                        </div>
                        <p class="text-brand-600 font-medium text-sm mt-1">${evt.date}</p>
                        <p class="text-gray-500 text-sm mt-1 flex items-center gap-1">
                            <i data-lucide="map-pin" class="w-3 h-3"></i> ${evt.loc}
                        </p>
                        <div class="mt-4 flex -space-x-2">
                            ${[1,2,3].map(i => `<img class="w-6 h-6 rounded-full border-2 border-white" src="https://i.pravatar.cc/100?img=${i+10}">`).join('')}
                            <div class="w-6 h-6 rounded-full border-2 border-white bg-gray-100 flex items-center justify-center text-[8px] font-bold text-gray-500">+42</div>
                        </div>
                    </div>
                </div>
            `).join('');

            return `
                <div class="p-6 max-w-2xl mx-auto space-y-6 animate-slide-up">
                    <div class="flex justify-between items-end">
                        <h2 class="text-2xl font-bold text-brand-900">Campus Events</h2>
                        <span class="text-sm text-brand-600 font-medium cursor-pointer">View Calendar</span>
                    </div>
                    ${list}
                </div>
            `;
        }

        function getProfileHTML() {
            const u = state.user;
            return `
                <div class="animate-slide-up">
                    <div class="relative bg-brand-700 h-48 md:rounded-b-3xl">
                         <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                    </div>
                    <div class="px-6 relative -mt-20 max-w-2xl mx-auto pb-8">
                        <div class="flex justify-between items-end mb-4">
                            <img src="${u.image}" class="w-32 h-32 rounded-3xl border-4 border-white shadow-lg bg-white object-cover">
                            <button class="bg-gray-900 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg hover:bg-gray-800 transition">
                                Edit Profile
                            </button>
                        </div>
                        
                        <h1 class="text-3xl font-bold text-gray-900">${u.name}</h1>
                        <p class="text-brand-600 font-medium mb-6">${u.course} ‚Ä¢ ${u.year}</p>

                        <div class="grid grid-cols-3 gap-4 mb-8 text-center">
                            <div class="bg-white p-3 rounded-2xl shadow-sm border border-gray-100">
                                <div class="text-2xl font-bold text-gray-900">${state.matches.length}</div>
                                <div class="text-xs text-gray-500 font-medium uppercase tracking-wide">Matches</div>
                            </div>
                            <div class="bg-white p-3 rounded-2xl shadow-sm border border-gray-100">
                                <div class="text-2xl font-bold text-gray-900">84%</div>
                                <div class="text-xs text-gray-500 font-medium uppercase tracking-wide">Profile</div>
                            </div>
                            <div class="bg-white p-3 rounded-2xl shadow-sm border border-gray-100">
                                <div class="text-2xl font-bold text-gray-900">12</div>
                                <div class="text-xs text-gray-500 font-medium uppercase tracking-wide">Views</div>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                                <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3">About</h3>
                                <p class="text-gray-700 leading-relaxed">${u.bio}</p>
                            </div>

                            <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                                <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3">Interests</h3>
                                <div class="flex flex-wrap gap-2">
                                    ${u.interests.map(i => `<span class="bg-brand-50 text-brand-700 px-3 py-1 rounded-lg text-sm font-medium border border-brand-100">${i}</span>`).join('')}
                                </div>
                            </div>
                        </div>

                         <div class="mt-8">
                             <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3 px-2">Settings</h3>
                            <button onclick="logout()" class="w-full bg-white text-red-500 font-bold py-4 rounded-2xl shadow-sm border border-gray-100 hover:bg-red-50 transition flex items-center justify-center gap-2">
                                <i data-lucide="log-out" class="w-5 h-5"></i> Log Out
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize
        render();

        // Scroll chat to bottom helper
        const observer = new MutationObserver(() => {
            const chatContainer = document.getElementById('chat-container');
            if (chatContainer) chatContainer.scrollTop = chatContainer.scrollHeight;
        });
        observer.observe(document.body, { childList: true, subtree: true });

    </script>
</body>
</html>
